<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚«ã‚¿ã‚«ãƒŠ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #ffffff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }
    header {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      padding: 10px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #logo {
      height: 80px;
    }
    .logo-wrapper {
      width: 100%;
      display: flex;
      justify-content: left;
      align-items: left;
      padding: 10px 0;
    }
    h1 {
      margin-top: 30px;
      font-size: 32px;
      color: #1a73e8;
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 5px;
      background-color: #1a73e8;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #stageButtons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 600px;
    }
    #game {
      margin-top: 40px;
      text-align: center;
    }
    #question {
      font-size: 48px;
      margin: 20px;
    }
    #question .kana {
      font-size: 56px;
      font-weight: bold;
      display: block;
    }
    #question .romaji {
      font-size: 24px;
      color: gray;
      margin-top: 5px;
      display: block;
    }
    #input {
      font-size: 24px;
      padding: 10px;
      width: 300px;
    }
    #feedback {
      margin: 20px;
      font-size: 20px;
      height: 30px;
    }
    #timer {
      font-size: 20px;
      color: red;
    }
    #result {
      font-size: 24px;
      margin: 40px;
    }
    .options {
      margin-top: 20px;
      font-size: 18px;
    }
    .options input {
      width: 60px;
      text-align: center;
    }
  </style>
</head>

<body>

<header>
  <div class="logo-wrapper">
    <img id="logo" src="kana.png" alt="Logo" />
  </div>
</header>

<h1>ã‚«ã‚¿ã‚«ãƒŠ ã‚¿ã‚¤ãƒ”ãƒ³ã‚° ã‚²ãƒ¼ãƒ </h1>

<!-- ì˜µì…˜ -->
<div class="options">
  ë¼ìš´ë“œ ìˆ˜: <input type="number" id="roundCount" value="10" min="1" max="40"> ê°œ
  &nbsp;&nbsp; ì œí•œ ì‹œê°„: <input type="number" id="timeLimit" value="15" min="5" max="60"> ì´ˆ
</div>

<!-- ë‹¨ê³„ ì„ íƒ ë²„íŠ¼ -->
<div id="stageButtons"></div>

<div id="game" style="display:none;">
  <div id="timer">15</div>
  <div id="question">---</div>
  <input id="input" type="text" onkeydown="handleKey(event)" autocomplete="off" />
  <div id="feedback"></div>
</div>

<div id="result" style="display:none;">
  <div id="resultText"></div>
  <button onclick="restartGame()" style="margin-top: 20px; padding: 10px 20px; font-size: 18px; background-color: #1a73e8; color: white; border: none; border-radius: 5px;">ğŸ” ë‹¤ì‹œ ì‹œì‘</button>
</div>

<script>
  const katakana = ["ã‚«","ã‚­","ã‚¯","ã‚±","ã‚³","ã‚µ","ã‚·","ã‚¹","ã‚»","ã‚½","ã‚¿","ãƒ","ãƒ„","ãƒ†","ãƒˆ","ãƒŠ","ãƒ‹","ãƒŒ","ãƒ","ãƒ","ãƒ","ãƒ’","ãƒ•","ãƒ˜","ãƒ›","ãƒ","ãƒŸ","ãƒ ","ãƒ¡","ãƒ¢","ãƒ¤","ãƒ¦","ãƒ¨","ãƒ©","ãƒª","ãƒ«","ãƒ¬","ãƒ­"];
  const halfKatakanapractice = [
    "ã‚·ãƒ¥ SHU","ã‚·ãƒ§ SHO","ã‚¸ãƒ¥ JU","ã‚¸ãƒ§ JO","ãƒãƒ¥ CHU","ãƒãƒ§ CHO","ãƒ‹ãƒ¥ NYU","ãƒ‹ãƒ§ NYO","ãƒ’ãƒ¥ HYU","ãƒ’ãƒ§ HYO","ãƒŸãƒ¥ MYU","ãƒŸãƒ§ MYO","ãƒªãƒ¥ RYU","ãƒªãƒ§ RYO","ã‚¯ã‚¡ KWA","ã‚¯ã‚£ KWI","ã‚¯ã‚§ KWE","ã‚¯ã‚© KWO"
  ];
  const halfKatakana = ["ã‚·ãƒ¥","ã‚·ãƒ§","ã‚¸ãƒ¥","ã‚¸ãƒ§","ãƒãƒ¥","ãƒãƒ§","ãƒ‹ãƒ¥","ãƒ‹ãƒ§","ãƒ’ãƒ¥","ãƒ’ãƒ§","ãƒŸãƒ¥","ãƒŸãƒ§","ãƒªãƒ¥","ãƒªãƒ§","ã‚¯ã‚¡","ã‚¯ã‚£","ã‚¯ã‚§","ã‚¯ã‚©"];
  const fullWords = ["ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ","ã‚¢ã‚¤ãƒ‡ã‚¢","ã‚¢ã‚¤ãƒ­ãƒ³","ã‚¢ã‚¦ãƒˆ","ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼","ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ","ã‚¢ã‚¸ã‚¢","ã‚¢ãƒ‰ãƒã‚¤ã‚¹","ã‚¢ãƒ‰ãƒ¬ã‚¹","ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼","ã‚¢ãƒŠã‚¦ãƒ³ã‚¹","ã‚¢ãƒ‹ãƒ¡","ã‚¢ãƒ‘ãƒ¼ãƒˆ","ã‚¢ãƒ•ãƒªã‚«","ã‚¢ãƒãƒãƒ¥ã‚¢","ã‚¢ãƒ¡ãƒªã‚«"];

  let currentStage = 1;
  let words = [];
  let displayWords = [];
  let current = 0;
  let correct = 0;
  let incorrect = 0;
  let wrongList = [];
  let roundCount = 10;
  let timeLimit = 15;
  let timerInterval;
  let answered = false;

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  const stages = {
    1: { name: "1ë‹¨ê³„: ê°€íƒ€ì¹´ë‚˜ ì—°ìŠµ", getWords: () => katakana, isPractice: false },
    2: { name: "2ë‹¨ê³„: ìš”ìŒ ì—°ìŠµ", getWords: () => halfKatakanapractice, isPractice: true },
    3: { name: "3ë‹¨ê³„: ìš”ìŒ í…ŒìŠ¤íŠ¸", getWords: () => halfKatakana, isPractice: false },
    4: { name: "4ë‹¨ê³„: ë‹¨ì–´ í…ŒìŠ¤íŠ¸", getWords: () => fullWords, isPractice: false }
  };

  window.onload = function() {
    const btnContainer = document.getElementById("stageButtons");
    for (let key in stages) {
      const btn = document.createElement("button");
      btn.textContent = `â–¶ ${stages[key].name}`;
      btn.onclick = () => startGame(parseInt(key));
      btnContainer.appendChild(btn);
    }
  };

  function startGame(stage) {
    roundCount = parseInt(document.getElementById("roundCount").value, 10) || 10;
    timeLimit = parseInt(document.getElementById("timeLimit").value, 10) || 15;

    currentStage = stage;
    document.getElementById("stageButtons").style.display = "none";

    if (stages[stage]) {
      let stageWords = stages[stage].getWords().slice();
      shuffle(stageWords);
      displayWords = stageWords.slice(0, roundCount);

      if (stages[stage].isPractice) {
        words = displayWords.map(w => w.split(" ")[0]);
      } else {
        words = displayWords;
      }
    } else {
      alert("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤!");
      return;
    }

    current = 0;
    correct = 0;
    incorrect = 0;
    wrongList = [];
    document.getElementById('result').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    nextQuestion();
  }

  function nextQuestion() {
    if (current >= words.length) {
      endGame();
      return;
    }

    document.getElementById('input').value = '';
    document.getElementById('feedback').innerText = '';

    if (stages[currentStage].isPractice) {
      const [kana, romaji] = displayWords[current].split(" ");
      document.getElementById('question').innerHTML = `<span class="kana">${kana}</span><span class="romaji">${romaji}</span>`;
    } else {
      document.getElementById('question').innerText = displayWords[current];
    }

    let timeLeft = timeLimit;
    answered = false;
    updateTimer(timeLeft);

    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimer(timeLeft);
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        markWrong("â±ï¸ ì‹œê°„ ì´ˆê³¼!", "", words[current]);
      }
    }, 1000);
  }

  function updateTimer(t) {
    document.getElementById('timer').innerText = t;
  }

  function handleKey(event) {
    if (event.key === 'Enter') {
      checkInput();
    }
  }

  function checkInput() {
    const input = document.getElementById('input').value.trim();
    if (!answered && input === words[current]) {
      answered = true;
      clearInterval(timerInterval);
      document.getElementById('feedback').innerText = 'â­• ì •ë‹µ!';
      correct++;
      current++;
      setTimeout(nextQuestion, 1000);
    } else if (!answered) {
      answered = true;
      clearInterval(timerInterval);
      markWrong("âŒ ì˜¤ë‹µ!", input, words[current]);
    }
  }

  function markWrong(message, inputValue, correctAnswer) {
    document.getElementById('feedback').innerText = `${message} ì •ë‹µ: ${correctAnswer}`;
    incorrect++;
    wrongList.push({ question: correctAnswer, answer: inputValue || "(ë¯¸ì…ë ¥)" });
    current++;
    setTimeout(nextQuestion, 1500);
  }

  function endGame() {
    document.getElementById('game').style.display = 'none';

    let wrongDetails = "";
    if (wrongList.length) {
      wrongDetails = "<br>âŒ í‹€ë¦° ë¬¸ì œ:<br>";
      wrongList.forEach((item, idx) => {
        wrongDetails += `${idx + 1}. ë¬¸ì œ: ${item.question} | ì…ë ¥: ${item.answer}<br>`;
      });
    } else {
      wrongDetails = "<br>ëª¨ë“  ë¬¸ì œë¥¼ ë§ì·„ìŠµë‹ˆë‹¤!";
    }

    const resultText = `ğŸ‰ ê²Œì„ ì¢…ë£Œ!<br>
      âœ… ì •ë‹µ ìˆ˜: ${correct}<br>
      âŒ ì˜¤ë‹µ ìˆ˜: ${incorrect}<br>
      ${wrongDetails}`;

    document.getElementById('resultText').innerHTML = resultText;
    document.getElementById('result').style.display = 'block';
  }

  function restartGame() {
    document.getElementById("stageButtons").style.display = "flex";
    document.getElementById('result').style.display = 'none';
  }
</script>

</body>
</html>
